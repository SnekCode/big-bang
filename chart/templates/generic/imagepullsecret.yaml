{{- range $pkgName, $pkg := .Values.addons -}}
{{- $name := kebabcase $pkgName -}}
{{- if and (include "imagePullSecret" $) (dig "enabled" false $pkg) (dig "useGenericTemplate" false $pkg) }}
---
apiVersion: v1
kind: Secret
metadata:
  name: private-registry
  namespace: {{ default $name (dig "namespace" "name" nil $pkg) }}
  labels:
    app.kubernetes.io/name: {{ $name }}
    {{- include "commonLabels" $ | nindent 4 }}
type: kubernetes.io/dockerconfigjson
data:
  .dockerconfigjson: {{ template "imagePullSecret" $ }}
{{- end }}
{{- end }}