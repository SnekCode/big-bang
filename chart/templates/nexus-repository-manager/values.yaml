{{- if .Values.addons.nexus.enabled }}
{{- include "values-secret" (dict "root" $ "package" .Values.addons.nexus "name" "nexus-repository-manager" "defaults" (include "bigbang.defaults.nexus-repository-manager" .)) }}
{{- end }}

{{- define "bigbang.defaults.nexus-repository-manager" -}}
domain: {{ .Values.hostname }}
hostname: {{ .Values.addons.nexus.hostname }}
istio:
  enabled: {{ .Values.istio.enabled }}

monitoring:
  enabled: {{ .Values.monitoring.enabled }}

nexus:
  imagePullSecrets:
    - name: private-registry


license_key: "{{ .Values.addons.nexus.license_key }}"

{{- if .Values.addons.nexus.sso.enabled }}
sso:
  enabled: {{ .Values.addons.nexus.sso.enabled }}
  idp_data:
    entityId: "{{ .Values.addons.nexus.sso.idp_data.entity_id }}"
    usernameAttribute: "{{ .Values.addons.nexus.sso.idp_data.username }}"
    firstNameAttribute: "{{ .Values.addons.nexus.sso.idp_data.firstName }}"
    lastNameAttribute: "{{ .Values.addons.nexus.sso.idp_data.lastName }}"
    emailAttribute: "{{ .Values.addons.nexus.sso.idp_data.email }}"
    groupsAttribute: "{{ .Values.addons.nexus.sso.idp_data.groups }}"
    validateResponseSignature: "{{ .Values.addons.nexus.sso.idp_data.validateResponseSignature | default "true" }}"
    validateAssertionSignature: "{{ .Values.addons.nexus.sso.idp_data.validateAssertionSignature | default "true" }}"
    idpMetadata: '{{ .Values.addons.nexus.sso.idp_data.idpMetadata }}'
  realm:
      {{- range .Values.addons.nexus.sso.realm }}
      - {{ . | quote }}
      {{- end }}
  {{- with .Values.addons.nexus.sso.role }}
  role:
    id: {{ .id }}
    name: {{ .name }}
    description: {{ .description }}
    privileges:
      {{- range .privileges }}
      - {{ . | quote }}
      {{- end }}
    roles:
      {{- range .roles }}
      - {{ . | quote }}
      {{- end }}
  {{- end }}
{{- end }}
{{- end -}}
